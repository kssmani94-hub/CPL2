{% extends "layout.html" %}
{% block title %}CPL 2025 - Players{% endblock %}

{# Set active page variable for layout #}
{% set active_page = 'players' %}

{% block content %}
<div class="main-container">
    <h2 class="page-title">CPL 2025 Player List</h2>

    <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">Show All</button>
        <button class="filter-btn" data-filter="retained">Show Retained</button> {# Added Retained Filter #}
        <button class="filter-btn" data-filter="auction">Show Auction Pool</button> {# Changed Label #}
        <button class="filter-btn" data-filter="sold">Show Sold (Auction)</button> {# Changed Label #}
        <button class="filter-btn" data-filter="unsold">Show Unsold (Auction)</button> {# Changed Label #}
    </div>

    <div class="player-table-card">

        <div class="player-table-grid player-header">
             <div class="header-cell player-name-header">PLAYER</div>
             <div class="header-cell cpl-stats-header">CPL 2024 STATS</div>
             <div class="header-cell overall-stats-header">OVERALL RECORD</div>
             
             {# CPL Sub-headers (6 columns) #}
             <div class="header-cell sub-header cpl-innings">INNINGS</div>
             <div class="header-cell sub-header cpl-runs">RUNS</div>
             <div class="header-cell sub-header cpl-wickets">WICKETS</div>
             <div class="header-cell sub-header cpl-sr">SR</div>
             <div class="header-cell sub-header cpl-hs hs-header">HS</div> {# Border class #}
             
             {# Overall Sub-headers (5 columns) #}
             <div class="header-cell sub-header ovr-matches">MATCHES</div>
             <div class="header-cell sub-header ovr-runs">RUNS</div>
             <div class="header-cell sub-header ovr-wickets">WICKETS</div>
             <div class="header-cell sub-header ovr-sr">SR</div>
             <div class="header-cell sub-header ovr-hs">HS</div>
        </div>
        {% for player in players %}
        <div class="player-table-grid player-row
                    {% if player.is_retained %}
                        retained
                    {% elif player.status == 'Sold' %}
                        sold
                    {% else %} {# Covers Unsold, Round X Unsold etc. #}
                        unsold
                    {% endif %}"
             data-status="{% if player.is_retained %}retained{% elif player.status == 'Sold' %}sold{% else %}unsold{% endif %}"> {# Simplified status for filter #}

            <div class="data-cell player-name">
                {{ player.player_name }}
                {% if player.is_retained and player.team %}
                    <span class="retained-badge">Retained by {{ player.team.team_name }}</span>
                {% endif %}
            </div>
            {# CPL Data (6 columns) #}
            <div class="data-cell">{{ player.cpl_2024_innings if player.cpl_2024_innings is not none else '-' }}</div>
            <div class="data-cell">{{ player.cpl_2024_runs if player.cpl_2024_runs is not none else '-' }}</div>
            <div class="data-cell">{{ player.cpl_2024_wickets if player.cpl_2024_wickets is not none else '-' }}</div>
            <div class="data-cell">{{ player.cpl_2024_sr if player.cpl_2024_sr is not none else '-' }}</div>
            <div class="data-cell hs-cell">{{ player.cpl_2024_hs if player.cpl_2024_hs is not none else '-' }}</div> {# Border class #}
            
            {# Overall Data (5 columns) #}
            <div class="data-cell">{{ player.overall_matches if player.overall_matches is not none else '-' }}</div>
            <div class="data-cell">{{ player.overall_runs if player.overall_runs is not none else '-' }}</div>
            <div class="data-cell">{{ player.overall_wickets if player.overall_wickets is not none else '-' }}</div>
            <div class="data-cell">{{ player.overall_sr if player.overall_sr is not none else '-' }}</div>
            <div class="data-cell">{{ player.overall_hs if player.overall_hs is not none else '-' }}</div>
        </div>
        {% endfor %}
        </div> </div>
{% endblock %}

{% block scripts %}
<script>
    document.querySelectorAll('.filter-btn').forEach(button => {
        button.addEventListener('click', () => {
            // Update active button style
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            const filterValue = button.getAttribute('data-filter'); // 'all', 'sold', 'unsold', 'retained', 'auction'

            // Show/hide rows based on filter
            document.querySelectorAll('.player-row').forEach(row => {
                const rowStatus = row.getAttribute('data-status'); // 'sold', 'unsold', or 'retained'
                const isRetained = (rowStatus === 'retained');

                let showRow = false;
                if (filterValue === 'all') {
                    showRow = true;
                } else if (filterValue === 'auction') {
                    showRow = !isRetained; // Show if NOT retained
                } else if (filterValue === rowStatus) {
                    showRow = true; // Show direct matches (sold, unsold, retained)
                }

                row.style.display = showRow ? 'grid' : 'none'; // Use 'grid' as display type
            });
        });
    });
</script>
{% endblock %}